---
globs: *.js
description: Node.js代理服务器配置和API转发规则
---

# 代理服务器架构

## 服务器配置

### 基本设置
- 端口：3001
- 框架：Express.js
- 中间件：CORS、express.json()
- 静态文件服务：当前目录

### API端点

#### 图片生成代理
```javascript
POST /api/image-synthesis
```
转发到：`https://dashscope.aliyuncs.com/api/v1/services/aigc/text2image/image-synthesis`

#### 任务查询代理
```javascript
GET /api/tasks/:taskId
```
转发到：`https://dashscope.aliyuncs.com/api/v1/tasks/${taskId}`

## 错误处理

### CORS问题解决
- 使用`cors()`中间件
- 允许所有源的请求
- 处理预检请求

### API错误转发
- 保持原始HTTP状态码
- 转发完整错误信息
- 添加代理层错误处理

## 启动和部署

### 开发环境
```bash
npm start  # 启动服务器
npm run dev  # 使用nodemon自动重启
```

### 生产环境注意事项
- 配置适当的CORS策略
- 添加请求限制和安全中间件
- 考虑使用PM2进行进程管理